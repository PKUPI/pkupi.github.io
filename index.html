<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0"/>
<title>YAS</title>
<link rel="shortcut icon" href="/favicon.ico"/>
<link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.jpg"/>
<script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css"/>
<style>
	td {
		white-space: nowrap;
	}
</style>
</head>
<body>
<div class="navbar navbar-default">
	<div class="container">
		<div class="navbar-header">
			<a class="navbar-brand" href="#">
				YAS
			</a>
			<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navBar">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</button>
		</div>
		<div class="collapse navbar-collapse navbar-right" id="navBar">
			<ul class="nav navbar-nav">
				<li><a href="/" target="_blank">首页</a></li>
				<li><a href="https://www.heavens-above.com" target="_blank">来源</a></li>
				<li class="dropdown" id="drop">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">手机浏览 <span class="caret"></span></a>
					<ul class="dropdown-menu" aria-labelledby="dropdown">
						<li><a href="javascript:void(0)">扫码打开本页面</a></li>
						<li>
							<img id="qrcode" style="width: 100%"/>
							<script>
								if (/mobile/i.test(navigator.userAgent) || /mobile/i.test(navigator.appVersion)) $("#drop").hide(); //window.hasOwnProperty("ontouchstart")
								$("#qrcode").attr("src", "https://api.galaxymimi.com/qrcode?margin=1&text=" + location.href);
							</script>
						</li>
					</ul>
				</li>
			</ul>
		</div>
	</div>
</div>
<div class="container">
	<h1>国际空间站（ISS）过境</h1>
</div>
<div class="container satellite" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2" style="vertical-align: middle">
					推荐度
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					日期
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					持续时间
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					星等
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					星图
				</td>
				<td align="center" colspan="6">
					升
				</td>
				<td align="center" colspan="6">
					到达高度10°
				</td>
				<td align="center" colspan="6">
					上中天
				</td>
				<td align="center" colspan="6">
					低于高度10°
				</td>
				<td align="center" colspan="6">
					降
				</td>
				<td align="center" colspan="6">
					离开地影
				</td>
				<td align="center" colspan="6">
					进入地影
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="satellite25544">
		</tbody>
	</table>
</div>

<div class="container">
	<h1>天宫二号过境</h1>
</div>
<div class="container satellite" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2" style="vertical-align: middle">
					推荐度
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					日期
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					持续时间
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					星等
				</td>
				<td align="center" rowspan="2" style="vertical-align: middle">
					星图
				</td>
				<td align="center" colspan="6">
					升
				</td>
				<td align="center" colspan="6">
					到达高度10°
				</td>
				<td align="center" colspan="6">
					上中天
				</td>
				<td align="center" colspan="6">
					低于高度10°
				</td>
				<td align="center" colspan="6">
					降
				</td>
				<td align="center" colspan="6">
					离开地影
				</td>
				<td align="center" colspan="6">
					进入地影
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="satellite41765">
		</tbody>
	</table>
</div>

<div class="container">
	<h1>铱星闪光</h1>
</div>
<div class="container iridium" style="overflow-x: scroll;">
	<table class="table table-striped table-bordered">
		<thead>
			<tr>
				<td align="center" rowspan="2">
					推荐度
				</td>
				<td align="center" rowspan="2">
					日期
				</td>
				<td align="center" rowspan="2">
					时间
				</td>
				<td align="center" rowspan="2">
					星等
				</td>
				<td align="center" rowspan="2">
					星图
				</td>
				<td align="center" rowspan="2">
					高度角
				</td>
				<td align="center" rowspan="2">
					方位角
				</td>
				<td align="center" rowspan="2">
					卫星
				</td>
				<td align="center" rowspan="2">
					至闪光中心距离
				</td>
				<td align="center" rowspan="2">
					闪光中心亮度
				</td>
				<td align="center" rowspan="2">
					至卫星距离
				</td>
				<td align="center" rowspan="2">
					与闪光中心线的夹角
				</td>
				<td align="center" rowspan="2">
					产生闪光的天线
				</td>
				<td align="center" rowspan="2">
					太阳高度
				</td>
				<td align="center" rowspan="2">
					对太阳的张角
				</td>
			</tr>
			<tr class="tr">
			</tr>
		</thead>
		<tbody id="IridiumFlares">
		</tbody>
	</table>
</div>
<script>
//var names = ["ISS", "TianGong", "IridiumFlares"];
var property = ["url", "date", "brightness", "events", "passType", "image", "scoreData", "exist", "score", "id"];
var events = ["rise", "reachAltitude10deg", "highestPoint", "dropBelowAltitude10deg", "set", "exitShadow", "enterShadow"];
var attribute = ["time", "altitude", "azimuth", "distance", "brightness", "sunAltitude"];
var eventsIridium = ["brightness", "altitude", "azimuth", "satellite", "distanceToFlareCentre", "brightnessAtFlareCentre", "date", "time", "distanceToSatellite", "AngleOffFlareCentre-line", "flareProducingAntenna", "sunAltitude", "angularSeparationFromSun", "image", "id"];

function appendThead() {
	$(".satellite .tr").append(`
				<td align="center">
					时间
				</td>
				<td align="center">
					高度角
				</td>
				<td align="center">
					方位角
				</td>
				<td align="center">
					距离
				</td>
				<td align="center">
					星等
				</td>
				<td align="center">
					太阳高度
				</td>`);
}

function showData(target, type) {
	var file = `data/${target}/index.json`;
	$.ajax(file, {
		type: "get",
		dataType: "text",
		error: function(xhr, status, error) {
			console.log("Error");
		},
		success: function(data, status, xhr) {
			var obj = JSON.parse(data);
			if (type == 0) obj.forEach(function(ele, index) {
				var html = `<td>${ele[property[8]]}</td>
					<td>${ele[property[1]]}</td>
					<td>${ele[property[7]]}</td>
					<td>${ele[property[2]]}</td>
					<td>
						<a href="download.html?target=${target}&id=${ele[property[9]]}" target="_blank">查看</a>
					</td>`;
				for (var j = 0; j < 7; j++) {
					if (ele[property[3]][events[j]]) {
						for (var k in ele[property[3]][events[j]]) {
							html += `<td>${ele[property[3]][events[j]][k]}</td>`;
						}
					}
					else {
						for (var k = 0; k < 6; k++) {
							html += "<td>N/A</td>";
						}
					}
				}
				if (index < 3) $("#" + target).append(`<tr style='background-color:rgb(0,200,50)'>${html}</tr>`);
				else if (ele[property[8]] == 0) $("#" + target).append(`<tr style="background-color:rgb(200,200,50)">${html}</tr>`);
				else $("#" + target).append(`<tr>${html}</tr>`);
			});
			else obj.forEach(function(ele, index) {
				var html = `<td>N/A</td>
					<td>${ele[eventsIridium[6]]}</td>
					<td>${ele[eventsIridium[7]]}</td>
					<td>${ele[eventsIridium[0]]}</td>
					<td>
						<a href="download.html?target=${target}&id=${ele[eventsIridium[14]]}" target="_blank">查看</a>
					</td>`;
				var map = [1, 2, 3, 4, 5, 8, 9, 10, 11, 12];
				for (var j = 0; j < 10; j++) {
					html += `<td>${ele[eventsIridium[map[j]]]}</td>`;
				}
				$("#" + target).append(`<tr>${html}</tr>`);
			});
		}
	});
}

for (var i = 0; i < 7; i++) appendThead();
showData("satellite25544", 0);
showData("satellite41765", 0);
showData("IridiumFlares", 1);
</script>
</body>
</html>
